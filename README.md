# The TOAD Planning System</h1>

TOAD is a planning system for Totally Ordered (TO) HTN planning. It translates the problem to a classical planning problem. For a subclass of TO problems, this is possible without relaxation, e.g., the solution found for the generated classical problem is guaranteed to be a solution for the HTN planning problem. Because ofthe differences in expressivity, this is not always possible. When it is not, the problem is transformed into a classical planning problem that has a superset of solutions, i.e. the plan found by the classical problem is not necessarily a solution for the HTN planning problem. In this case, an HTN plan verification system needs to be applied after a solution is found.

To use the planner, perform the following steps: 
- Ground the problem using the <a href="https://toad-planner-dev.github.io/">PANDA grounder</a>. Let ground.panda be the file with the grounded model.
- Call TOAD: toad BU-IO ground.panda. TOAD generates a classical planning problem. It uses the sas+ format used by <a href="http://www.fast-downward.org/">Fast Downward</a> as standard output format. Let problem.sas be that file.
- Use <a href="http://www.fast-downward.org/">Fast Downward</a> with your favorit configuration to solve that problem, e.g.: ./downward --evaluator 'hff=ff()' --search 'lazy_greedy([hff], preferred=[hff])' --internal-plan-file sas_plan < problem.sas. Let sas_plan be the generated solution.
- Step 2 writes a file called "verify.log", its first line states whether verification is needed. If it is needed, perform the following steps to verify whether the solution is one for the HTN planning problem.
- Generate a verification problem using e.g. using <a href="https://github.com/panda-planner-dev/pandaPIpgrRepairVerify">the PANDA verifier</a>
- Its output is a usual HTN planning problem. It has a solution if and only if the solution generated by FD is a solution for the HTN planning problem. We used <a href="https://github.com/panda-planner-dev/pandaPIengine">the progression search of the HTN planning system PANDA</a> to solve it. 

Please cite the following when referencing TOAD:
- <a href="http://fai.cs.uni-saarland.de/hoeller/index.html">D. H&ouml;ller</a>. <strong>Translating Totally Ordered HTN Planning Problems to Classical Planning Problems Using Regular Approximation of Context-Free Languages</strong>. In: Proceedings of the 31st International Conference on Automated Planning and Scheduling (ICAPS). AAAI Press, 2021. <a href="https://fai.cs.uni-saarland.de/hoeller/papers/2021-Hoeller-ICAPS-Toad.pdf">(pdf)</a>
- <a href="http://fai.cs.uni-saarland.de/hoeller/index.html">D. H&ouml;ller</a>. <strong>The TOAD System for Totally Ordered HTN Planning</strong>. Journal of Artificial Intelligence Research 80: pages 613â€“663, 2024. <a href="https://jair.org/index.php/jair/article/view/14945/27049">(pdf)</a>
